files:
    "/etc/cron.d/mycron":
        mode: "000644"
        owner: root
        group: root
        content: |
            * * * * * root /usr/local/bin/myscript.sh


    "/usr/local/bin/myscript.sh":
        mode: "000755"
        owner: root
        group: root

        content: |
            #!/bin/bash


            # Your actual script content

            THE_DATABASE=staging
            MY_TABLE=message
            THE_DATE_VARIABLE_NAME=created_at

            psql ${THE_DATABASE} <<THE_END
              SELECT COUNT(*) FROM ${MY_TABLE}
              WHERE ${THE_DATE_VARIABLE_NAME} >= < now() - interval '20 days'
            THE_END

            exit 0

commands:
    remove_old_cron:
        command: "rm -f /etc/cron.d/*.bak"
